<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-caesar/slicing" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Program Slicing | Caesar</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.caesarverifier.org/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://www.caesarverifier.org/img/social-card.png"><meta data-rh="true" property="og:url" content="https://www.caesarverifier.org/docs/caesar/slicing"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Program Slicing | Caesar"><meta data-rh="true" name="description" content="Caesar supports program slicing on the HeyVL intermediate verification language."><meta data-rh="true" property="og:description" content="Caesar supports program slicing on the HeyVL intermediate verification language."><link data-rh="true" rel="icon" href="/img/laurel.svg"><link data-rh="true" rel="canonical" href="https://www.caesarverifier.org/docs/caesar/slicing"><link data-rh="true" rel="alternate" href="https://www.caesarverifier.org/docs/caesar/slicing" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.caesarverifier.org/docs/caesar/slicing" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Caesar RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Caesar Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-73RDXJSM5X"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-73RDXJSM5X",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.b070e9d8.css">
<link rel="preload" href="/assets/js/runtime~main.639b0ec0.js" as="script">
<link rel="preload" href="/assets/js/main.74b8c474.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/laurel.svg" alt="Caesar Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/laurel.svg" alt="Caesar Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Caesar</b></a><a class="navbar__item navbar__link" href="/docs/getting-started">Getting Started</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/blog">News</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/moves-rwth/caesar" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a class="navbar__item navbar__link" href="/docs/publications">Publications</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/getting-started/">Getting Started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/heyvl/">HeyVL</a><button aria-label="Toggle the collapsible sidebar category &#x27;HeyVL&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/stdlib/">Standard Library</a><button aria-label="Toggle the collapsible sidebar category &#x27;Standard Library&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/proof-rules/">Proof Rules</a><button aria-label="Toggle the collapsible sidebar category &#x27;Proof Rules&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/caesar/">The Caesar Tool</a><button aria-label="Toggle the collapsible sidebar category &#x27;The Caesar Tool&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/caesar/slicing">Program Slicing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/caesar/optimizations">Optimizations &amp; Alternative Implementations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/caesar/benchmarks">Benchmarks</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/model-checking">Model Checking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/devguide">Development Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/publications">Publications</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/OOPSLA_AEC">OOPSLA &#x27;23 Artifact Evaluation Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/pgcl">pGCL Frontend</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/caesar/"><span itemprop="name">The Caesar Tool</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Program Slicing</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Program Slicing</h1><p>Caesar supports <em>program slicing</em> on the HeyVL intermediate verification language.
It is the basis for Caesar&#x27;s localized error reporting (e.g. &quot;this loop invariant may not be inductive&quot;), but we support more generalized slicing criteria as well.</p><p>Caesar has support for <a href="#slicing-for-errors"><em>slicing for errors</em></a>, which aims at a sliced program that fails with a counter-example.
<a href="#assertion-slicing"><em>Assertion slicing</em></a> with its purpose of localizing error messages falls is a kind of slicing for errors.
<a href="#slicing-for-correctness"><em>Slicing for correctness</em></a> is aimed at finding a sliced program that verifies.
<a href="#assumption-slicing"><em>Assumption slicing</em></a> is one kind of slicing for correctness.</p><p>Fun fact: Caesar&#x27;s slicing feature was developed with the project name <em>Brutus</em> <!-- -->—<!-- --> alluding to Caesar&#x27;s adopted son, who also famously participated in a very different way of slicing...</p><hr><p><strong>In this document:</strong></p><div class="tableOfContentsInline_prmo"><ul class="table-of-contents"><li><a href="#overview">Overview</a></li><li><a href="#slicing-for-errors">Slicing for Errors</a><ul><li><a href="#assertion-slicing">Assertion Slicing</a></li><li><a href="#general-slicing-for-errors">General Slicing for Errors</a></li></ul></li><li><a href="#slicing-for-correctness">Slicing for Correctness</a><ul><li><a href="#assumption-slicing">Assumption Slicing</a></li><li><a href="#general-slicing-for-correctness">General Slicing for Correctness</a></li></ul></li><li><a href="#slicing-annotations">Slicing Annotations</a><ul><li><a href="#slicing-message-annotations">Slicing Message Annotations</a></li><li><a href="#slicing-selections">Slicing Selections</a></li></ul></li><li><a href="#a-theory-of-slicing-for-heyvl">A Theory of Slicing for HeyVL</a><ul><li><a href="#slice-effects">Slice Effects</a></li></ul></li><li><a href="#implementation-details">Implementation Details</a><ul><li><a href="#program-transformation">Program Transformation</a></li><li><a href="#solving-for-minimal-slices">Solving for Minimal Slices</a></li></ul></li></ul></div><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2><p><a href="#assertion-slicing"><em>Assertion slicing</em></a> is enabled by default on every verification query to help interpret a counterexample.
It does this by finding a minimal set of <code>assert</code>-like statements that must be in the code to obtain a verification error.
Caesar&#x27;s built-in <a href="/docs/proof-rules/">proof rules</a> have annotations that provide interpretations to every <code>assert</code>.
For example, there is an assertion in the encoding of <a href="/docs/proof-rules/induction">induction</a> whose presence in a minimal counterexample slice means that the invariant might not be inductive.</p><p><a href="#assumption-slicing"><em>Assumption slicing</em></a> must be enabled with the <code>--slice-verify</code> command-line flag.
It can be used to find a minimal set of <code>assume</code>-like statements with which the program verifies.
This may help optimizing or understanding a HeyVL proof.
For example, there&#x27;s an <code>assume</code> in the induction encoding inside a verifying HeyVL program.
The removal of that <code>assume</code> indicates that a <code>while</code> loop could also be just a simple <code>if</code> statement for verification.
This could indicate a problem in the specification to be proved if the user knows a <code>while</code> statement should be necessary.</p><p><a href="#slicing-for-errors"><em>Slicing for errors</em></a> generalizes assertion slicing to statements that are not necessarily <code>assert</code>-like and <a href="#general-slicing-for-correctness"><em>slicing for correctness</em></a> does the same for statements that are not necessarily <code>assume</code>-like.
We discuss these generalized applications in the respective sections <a href="#general-slicing-for-errors">General Slicing for Errors</a> and <a href="#general-slicing-for-correctness">General Slicing for Correctness</a>.</p><p>On a very high level, Caesar&#x27;s program slicing works by trying all different combinations of removing all candidate statements for the slice.
Our <a href="#a-theory-of-slicing-for-heyvl">theory of slicing</a> for HeyVL formalizes the ideas of <em><code>assert</code>-like</em> and <em><code>assume</code>-like</em> via the <em>discordant</em> and <em>concordant</em> definitions and specifies soundness of slicing using these terms.
Caesar&#x27;s <a href="#slicing-annotations">annotations for slicing</a> can be used to add slicing information to statements such as error messages for assertions.
In the last section of this document, we describe <a href="#implementation-details">implementation details</a> of the slicing algorithm in Caesar.</p><p>Interestingly, Caesar&#x27;s slicing is in essence not very different from slicing-like approaches in classical deductive verifiers.
We just generalized the ideas to the <em>quantitative</em> setting of our intermediate verification language HeyVL, but the ideas are equally applicable to the <em>qualitative</em> setting.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>Since our approach generalizes the qualitative setting and to simplify the presentation here, we will mostly give <em>qualitative</em> examples in the following to illustrate the ideas.
But keep in mind that everything also works for quantitative verification tasks in the same way.</p></div></div><p>To our knowledge, Caesar&#x27;s implementation of slicing is the first one that combines both slicing for errors, for correctness, on an IVL, in the quantitative setting.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Our slicing approach is still a work-in-progress which we hope to present in an upcoming academic publication.</p></div></div><p>The following flowchart illustrates Caesar&#x27;s slicing algorithm.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="slicing-for-errors">Slicing for Errors<a href="#slicing-for-errors" class="hash-link" aria-label="Direct link to Slicing for Errors" title="Direct link to Slicing for Errors">​</a></h2><p><em>Slicing for errors</em> takes a HeyVL program and tries to remove as many statements from the <em>slice selection</em> as possible such that the resulting program fails verification with a counter-example.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="assertion-slicing">Assertion Slicing<a href="#assertion-slicing" class="hash-link" aria-label="Direct link to Assertion Slicing" title="Direct link to Assertion Slicing">​</a></h3><p><em>Assertion slicing</em> is program slicing with the specific purpose of interpreting counter-examples for verification from the SMT solver.
The slice selection consists of all <code>assert</code>-like statements (cf. <a href="#a-theory-of-slicing-for-heyvl"><em>A Theory of Slicing for HeyVL</em></a> for details).</p><p>Consider the following HeyVL proc which does not verify:</p><div class="language-heyvl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-heyvl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">proc</span><span class="token plain"> two_asserts(x: </span><span class="token builtin" style="color:rgb(72, 118, 214)">UInt</span><span class="token plain">) </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> ()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">assert</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">?</span><span class="token plain">(x </span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token plain">)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">assert</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">?</span><span class="token plain">(x </span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token plain">)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Clearly, the first assertion is not a problem since all <code>UInt</code> values are non-negative.
The second one fails when the input is <code>x = 0</code>.
The SMT solver will indeed give us that counter-example, but we still need to associate this counter-example to a specific assertion.
While we can simply try to evaluate all assertions in state <code>x = 0</code> for this example, this becomes impossible when we do not know what the exact state will be in a later statement.
This can happen after nondeterministic and probabilistic choices, or after unbounded loops.</p><p>Caesar instead looks at different counterfactuals for the current verification problem.</p><ol><li>Does a verification failure still occur with the first assert removed? Yes.</li><li>Does a verification failure still occur with the second assert removed? No.</li></ol><p>From this we can conclude that the second assert is at fault and <em>responsible</em> for the verification failure.
In general, Caesar will try to find a minimal <em>set</em> of assertions that will lead to a verification error.
The result is an error message like this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">program.heyvl::two_asserts: Counter-example to verification found!</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    input variables:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        x: 0                                       (program.heyvl:1:12)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    the pre-quantity evaluated to:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        0</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    program slice:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        ❌ assertion might not hold                  (program.heyvl:4:5)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This message&#x27;s &quot;program slice&quot; section points to the second assertion in line 4.</p><p>Note that the minimal sets of assertions from counter-examples are not necessarily unique!
There might be even more verification failures after the assertions from slicing are removed.
The program slice from slicing for errors only constitutes a set from which no assertion can be removed while still getting an error (hence, <em>minimal</em>).</p><p>In theory, we could also look at assertions which are not present in <em>any</em> minimal slice for errors to determine assertions which are <em>never</em> a problem.
However, we have not found this useful and have not looked at this further.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="general-slicing-for-errors">General Slicing for Errors<a href="#general-slicing-for-errors" class="hash-link" aria-label="Direct link to General Slicing for Errors" title="Direct link to General Slicing for Errors">​</a></h3><p>Only trying to remove <code>assert</code>-like statements may be too restrictive for certain applications.
Consider the following simple example:</p><div class="language-heyvl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-heyvl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">proc</span><span class="token plain"> assign_error() </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> (x: </span><span class="token builtin" style="color:rgb(72, 118, 214)">UInt</span><span class="token plain">) </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    x </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    x </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    x </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    x </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">assert</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">?</span><span class="token plain">(x </span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">8</span><span class="token plain">)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This example will fail to verify since <code>x = 16</code> holds at the <code>assert</code>.
Caesar will also report the assertion as the culprit, but which assignments are problematic?</p><p>We can annotate the assignments to instruct Caesar to also try to remove them to still get a counterexample (cf. <a href="#slicing-annotations">slicing annotations documentation</a>).</p><div class="language-heyvl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-heyvl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">proc</span><span class="token plain"> assign_error() </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> (x: </span><span class="token builtin" style="color:rgb(72, 118, 214)">UInt</span><span class="token plain">) </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    x </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">@slice_error</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">@error_msg</span><span class="token plain">(&quot;first needed&quot;) x </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">@error_msg</span><span class="token plain">(&quot;second needed&quot;) x </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">@error_msg</span><span class="token plain">(&quot;third needed&quot;) x </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">assert</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">?</span><span class="token plain">(x </span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">8</span><span class="token plain">)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The result is something like this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">program.heyvl::assign_error: Counter-example to verification found!</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    the pre-quantity evaluated to:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        0</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    program slice:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        ❌ first needed                             (program.heyvl:4:36)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        ❌ third needed                             (program.heyvl:6:36)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        ❌ assertion might not hold                  (program.heyvl:8:5)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>While this example is somewhat silly, one can imagine a more complicated example where removing assignments might be helpful to narrow down the problem.</p><p>You may ask: why do we not try slice assignments by default?
The answer is that assignments are not <em>discordant</em> according to our <a href="#a-theory-of-slicing-for-heyvl"><em>theory of slicing for HeyVL</em></a>, i.e. removing them does not allow us to conclude something about the original program directly.
In general, a counterexample of a HeyVL program with a removed assertion might imply that the original also has a counterexample (as is the case here), but it could also not imply it.
It might even imply that the original program verified!
Consider a program like <code>x = true; x = !x; assert ?(x)</code> for example.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="slicing-for-correctness">Slicing for Correctness<a href="#slicing-for-correctness" class="hash-link" aria-label="Direct link to Slicing for Correctness" title="Direct link to Slicing for Correctness">​</a></h2><p><em>Slicing for correctness</em> takes a HeyVL program and tries to remove as many statements from the <em>slice selection</em> as possible such that the resulting program verifies.</p><div class="theme-admonition theme-admonition-danger alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_S0QG"><p>The current implementation of slicing for correctness is <strong>unsound</strong> for programs that contain <a href="/docs/heyvl/domains">uninterpreted functions</a>.
This unsoundness also follows for assumption slicing.
Note that uninterpreted functions may also be generated internally for <a href="/docs/heyvl/expressions#quantifiers">quantitative quantifiers</a> if they are not eliminated by Caesar&#x27;s quantifier elimination procedure.
If you enable <code>--slice-verify</code>, you must currently <strong>check yourself</strong> that you do not use uninterpreted functions.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="assumption-slicing">Assumption Slicing<a href="#assumption-slicing" class="hash-link" aria-label="Direct link to Assumption Slicing" title="Direct link to Assumption Slicing">​</a></h3><p><em>Assumption slicing</em> selects all <code>assume</code>-like statements as candidates to remove from the program and slices so that the resulting program verifies.
After this process, we can get a minimal set of assumptions which are needed for the program to still verify.
From the set of assumptions which are <em>not</em> included in the minimal necessary slice to verify, we can generate warnings which might indicate a problem to the user.
For example we might find out that a pre to a proc is not necessary.</p><p>Consider the following program:</p><div class="language-heyvl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-heyvl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">proc</span><span class="token plain"> assumes(x: </span><span class="token builtin" style="color:rgb(72, 118, 214)">UInt</span><span class="token plain">) </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> ()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">pre</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">?</span><span class="token plain">(x </span><span class="token operator" style="color:rgb(12, 150, 155)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">42</span><span class="token plain">)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">assume</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">assert</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">?</span><span class="token plain">(x </span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token plain">)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Caesar will emit an output similar to this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">program.heyvl::assumes: Verified.</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    program slice:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        🤷 assumption is not necessary              (program.heyvl:4:5)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As is the case in <a href="#assertion-slicing">assertion slicing</a>, the minimal set of assumptions is not necessarily unique.
We also do not search for assumptions which are included in no minimal set of assumptions, instead for just one minimal set from which we cannot remove an assumption without the program not verifying.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="general-slicing-for-correctness">General Slicing for Correctness<a href="#general-slicing-for-correctness" class="hash-link" aria-label="Direct link to General Slicing for Correctness" title="Direct link to General Slicing for Correctness">​</a></h3><p>Consider the following example, in which we sample two bits with fair coin flips.
The specification says that the probability of a value of the sampled value <code>r &gt;= 2</code> is at least <code>1/2</code>.
The specification holds, but only one assignment is actually necessary!</p><div class="language-heyvl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-heyvl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">proc</span><span class="token plain"> bits() </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> (r: </span><span class="token builtin" style="color:rgb(72, 118, 214)">EUReal</span><span class="token plain">)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">pre</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token operator" style="color:rgb(12, 150, 155)">/</span><span class="token number" style="color:rgb(170, 9, 130)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">post</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain">r </span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">var</span><span class="token plain"> b0: </span><span class="token builtin" style="color:rgb(72, 118, 214)">UInt</span><span class="token plain">; </span><span class="token keyword" style="color:rgb(12, 150, 155)">var</span><span class="token plain"> b1: </span><span class="token builtin" style="color:rgb(72, 118, 214)">UInt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">@slice_verify</span><span class="token plain">() </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">var</span><span class="token plain"> choice: </span><span class="token builtin" style="color:rgb(72, 118, 214)">Bool</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> flip(</span><span class="token number" style="color:rgb(170, 9, 130)">0.5</span><span class="token plain">)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> choice </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> b0 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> b0 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        choice </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> flip(</span><span class="token number" style="color:rgb(170, 9, 130)">0.5</span><span class="token plain">)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> choice </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> b1 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"> b1 </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        r </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> b0 </span><span class="token operator" style="color:rgb(12, 150, 155)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> b1</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Running Caesar with the <code>--slice-verify</code> option on this program, we get the following output:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">program.heyvl::bits: Verified.</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    program slice:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        🤷 statement in line 9 is not necessary       (program.heyvl:9:21)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        🤷 statement in line 9 is not necessary       (program.heyvl:9:37)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        🤷 statement in line 11 is not necessary     (program.heyvl:11:21)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>From this we can conclude that all but the <code>b1 = 1</code> assignment are actuallly not necessary to satisfy the specification.</p><p>Analogous to the case in <a href="#general-slicing-for-errors">general slicing for errors</a>, we need to explicitly instruct Caesar to try to remove assignments during slicing for correctness using the <code>@slice_verify</code> annotation (cf. <a href="#slicing-selections">slice selection annotations</a>).
If Caesar tried to remove all assignments by default, we would not necessarily gain any knowledge about the original program.
More details in the <a href="#a-theory-of-slicing-for-heyvl">theory of slicing for HeyVL</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="slicing-annotations">Slicing Annotations<a href="#slicing-annotations" class="hash-link" aria-label="Direct link to Slicing Annotations" title="Direct link to Slicing Annotations">​</a></h2><p>For both slicing for errors and correctness, Caesar has some built-in defaults.
This includes a default <em>slice selection</em> and messages for the statements (such as &quot;assertion might not hold&quot;).
These defaults can be overwritten by annotations on statements.
Internally, Caesar also uses these statements, e.g. in the generated encodings for <a href="/docs/proof-rules/">proof rules</a> to attach messages to statements such as an assertion for an inductiveness check of a loop.</p><p>The annotations can be added to blocks and compositional statements such as <code>if</code>-statements and will be inherited by all sub-statements.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="slicing-message-annotations">Slicing Message Annotations<a href="#slicing-message-annotations" class="hash-link" aria-label="Direct link to Slicing Message Annotations" title="Direct link to Slicing Message Annotations">​</a></h3><p>The <code>@error_msg</code> and the <code>@success_msg</code> annotations can be used to attach messages in case a statement is sliced for errors and correctness, respectively.
For example:</p><div class="language-heyvl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-heyvl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">proc</span><span class="token plain"> two_asserts(x: </span><span class="token builtin" style="color:rgb(72, 118, 214)">UInt</span><span class="token plain">) </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> ()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">@error_msg</span><span class="token plain">(&quot;x at least zero not necessary&quot;) </span><span class="token keyword" style="color:rgb(12, 150, 155)">assert</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">?</span><span class="token plain">(x </span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token plain">)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">@error_msg</span><span class="token plain">(&quot;x at least one not necessary&quot;) </span><span class="token keyword" style="color:rgb(12, 150, 155)">assert</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">?</span><span class="token plain">(x </span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token plain">)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Will result in the following section in the counter-example:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">[...]</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    program slice:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        ❌ x at least one does not hold             (program.heyvl:4:48)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>@success_msg</code> annotation is used in the same way.</p><p>Tip: You can inspect the internally generated slicing message annotations from built-in proof rules by passing the <code>--print-core-procs</code> command-line option to Caesar.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="slicing-selections">Slicing Selections<a href="#slicing-selections" class="hash-link" aria-label="Direct link to Slicing Selections" title="Direct link to Slicing Selections">​</a></h3><p>By default, Caesar selects <code>assert</code>-like statements (&quot;discordant&quot;) for slicing for errors and <code>assume</code>-like statements (&quot;concordant&quot;) for slicing for correctness.
The terms <em>discordant</em> and <em>concordant</em> are defined in our <a href="#a-theory-of-slicing-for-heyvl">theory of slicing for HeyVL</a>.</p><p>In addition to these defaults, Caesar has annotations to add other statements to the slice selection:</p><ul><li><code>@slice_verify</code>: Also slice this statement during <em>slicing for correctness</em>.</li><li><code>@slice_error</code>: Also slice this statement during <em>slicing for errors</em>.</li></ul><p>Note that these annotations will enable slicing for individual sub-statements, not whole blocks.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-theory-of-slicing-for-heyvl">A Theory of Slicing for HeyVL<a href="#a-theory-of-slicing-for-heyvl" class="hash-link" aria-label="Direct link to A Theory of Slicing for HeyVL" title="Direct link to A Theory of Slicing for HeyVL">​</a></h2><p>When is it &quot;correct&quot; to slice a statement?
What does it mean if we know a statement has been removed from the program?
Our theory of slicing for HeyVL aims to give clear correctness criteria for slicing.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>The theory is based on the verification condition semantics of HeyVL.
You can find some information in the <a href="/docs/heyvl/statements">statements documentation</a> and all relevant formal background in our <a href="/docs/publications#oopsla-23">OOPSLA &#x27;23 paper</a>.
We are working on an academic publication about these ideas that goes into more detail.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="slice-effects">Slice Effects<a href="#slice-effects" class="hash-link" aria-label="Direct link to Slice Effects" title="Direct link to Slice Effects">​</a></h3><p>At the core of our theory of slicing for HeyVL are <em>slice effects</em>, which categorize each HeyVL statement into one of three categories: <em>concordant</em>, <em>discordant</em>, and <em>ambiguous</em>.
You can think of <em>concordant</em> statements as <em>like assumptions</em> and of <em>discordant</em> statements as <em>like assertions</em>.
Slice effects depend on the current <em>direction</em> in which we verify.
In a <code>proc</code>, our direction is <em>down</em> (<em>lower bounds</em>), and in a <code>coproc</code>, the direction is <em>up</em> (<em>upper bounds</em>).</p><p>Formally, we define <em>concordant</em>  and <em>discordant</em> as follows:</p><ul><li>In <code>proc</code>s:<ul><li>A statement <code>S</code> is <em>concordant</em> when for all <code>post</code> it holds that <code>post = vc[skip](post) &lt;= vc[S](post)</code>.</li><li>A statement <code>S</code> is <em>discordant</em> when for all <code>post</code> it holds that <code>post = vc[skip](post) &gt;= vc[S](post)</code>.</li></ul></li><li>In <code>coproc</code>s, the definitions are reversed:<ul><li>A statement <code>S</code> is <em>concordant</em> when for all <code>post</code> it holds that <code>post = vc[skip](post) &gt;= vc[S](post)</code>.</li><li>A statement <code>S</code> is <em>discordant</em> when for all <code>post</code> it holds that <code>post = vc[skip](post) &lt;= vc[S](post)</code>.</li></ul></li></ul><p>Informally, introducing <em>concordant</em>  will make them only <em>verify more</em>, i.e. the <code>vc</code> semantics will at most increase in <code>proc</code>s (or at least decrease in <code>coproc</code>s).
This means if we removed them, we can re-insert concordant statements and the program will still verify.
On the other hand, <em>discordant</em> statements will make programs <em>verify less</em>, i.e. the <code>vc</code> semantics will at most decrease in <code>proc</code>s (or at least increase in <code>coproc</code>s).
That means if we removed them, we can re-insert concordant statements and if the sliced program failed to verify, the original program will also fail to verify.</p><p>Below is a table of HeyVL statements and their slice effects.
It should be pretty intuitive: <code>assume</code> statements are concordant with respect to lower bounds, and <code>assert</code>, <code>havoc</code>, and <code>validate</code> are discordant.
When they&#x27;re used in upper bound contexts, then their effects are reversed.
For the <code>co</code>-statements, the situation is also exactly reversed.</p><table style="float:left;padding-right:2em"><thead><tr><td>Statement</td><td><code>proc</code></td><td><code>coproc</code></td></tr></thead><tbody><tr><td><code>assume</code></td><td>Concordant</td><td>Discordant</td></tr><tr><td><code>assert</code></td><td>Discordant</td><td>Concordant</td></tr><tr><td><code>havoc</code></td><td>Discordant</td><td>Concordant</td></tr><tr><td><code>validate</code></td><td>Discordant</td><td>Concordant</td></tr></tbody></table><table style="float:left"><thead><tr><td>Statement</td><td><code>proc</code></td><td><code>coproc</code></td></tr></thead><tbody><tr><td><code>coassume</code></td><td>Discordant</td><td>Concordant</td></tr><tr><td><code>coassert</code></td><td>Concordant</td><td>Discordant</td></tr><tr><td><code>cohavoc</code></td><td>Concordant</td><td>Discordant</td></tr><tr><td><code>covalidate</code></td><td>Concordant</td><td>Discordant</td></tr></tbody></table><div style="clear:both"></div><p>Note that Caesar only tries to slice <code>(co)assume</code> and <code>(co)assert</code> statements, but not <code>(co)havoc</code> nor <code>(co)validate</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-details">Implementation Details<a href="#implementation-details" class="hash-link" aria-label="Direct link to Implementation Details" title="Direct link to Implementation Details">​</a></h2><p>Caesar&#x27;s implementation of slicing is a two-stage approach.
It first does a <a href="#program-transformation">program transformation</a> to prepare the input program for slicing.
Then we use the SMT solver to minimize the number of enabled statements in the slice in the <a href="#solving-for-minimal-slices">solving for minimal slices</a> stage.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="program-transformation">Program Transformation<a href="#program-transformation" class="hash-link" aria-label="Direct link to Program Transformation" title="Direct link to Program Transformation">​</a></h3><p>To prepare a HeyVL program for slicing, Caesar starts with a <em>slice selection</em> of potential statements to slice.
Usually, that&#x27;s discordant statements and those enabled with explicit <a href="#slicing-selections">slice selection annotations</a>.
If the option <code>--slice-verify</code> is set, then we also transform concordant statements as well.</p><p>For each potentially sliceable statement <code>S</code>, we create a new Boolean input variable <code>slice_S</code> to the program.
The statement <code>S_i</code> is (logically) replaced by <code>if slice_i { S } else {}</code>.
In the implementation, we have specialized transformations for almost all kinds of statements to avoid exponential blow-up of the generated verification conditions.</p><p>Consider an assumption <code>assume f</code>.
If we just wrapped it into an <code>if</code> statement, then we would get verification conditions that contain the post twice:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">vc[if slice_1 { assume f } else {}](post) = ite(slice_1, f ==&gt; post, post)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>However, we do an equivalent transformation so that the post is not duplicated:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">vc[assume ite(slice_1, f, 0)](post) = (ite(slice_1, f, 0) ==&gt; post)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="solving-for-minimal-slices">Solving for Minimal Slices<a href="#solving-for-minimal-slices" class="hash-link" aria-label="Direct link to Solving for Minimal Slices" title="Direct link to Solving for Minimal Slices">​</a></h3><p>After this program transformation, every potentially sliceable statement is associated with a Boolean variable that we can use to turn it on or off.
That means we can just set constraints on the number of enabled statements in the SMT solver to query for a new slice.
We do <em>not</em> need to re-generate verification conditions, nor do we re-do our optimizations.
This allows us to take advantage of the abilities of modern SMT solvers to try a lot of Boolean combinations very quickly.</p><p>When we <a href="#slicing-for-errors">slice for errors</a>, we can generate a nice exists-exists query that looks for a counter-example to verification with an assignment to the enabled variables.
It is of the form</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">exists slice_1,...,slice_n: exists initial_state: vc[S](\infty) != \infty</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><a href="#slicing-for-correctness">Slicing for correctness</a> unfortunately generates a quantifier alternation.
We ask the SMT solver to find an assignment to the slice variables such that <em>for all</em> initial states the program verifies:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">exists slice_1,...,slice_n: forall initial_state: vc[S](\infty) == \infty</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After building these new verification queries for slicing, we minimize the number of enabled statements by iteratively asking the SMT solver for a solution with a smaller number of enabled slice variables.
We do a kind of binary search that takes into account the possibility of an &quot;unknown&quot; result from the SMT solver.</p><p>As far as we could tell, using e.g. Z3&#x27;s built-in optimizer for these tasks is often infeasible as it is restricted to a (not particularly well-defined) fragment of input formulas and <em>may return unsound results</em> on other inputs.
It also seems to be designed to find actually optimal results, whereas we are also happy with a &quot;good&quot; result if some timeout expires.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/moves-rwth/caesar/tree/main/website/docs/caesar/slicing.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/caesar/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">The Caesar Tool</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/caesar/optimizations"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Optimizations &amp; Alternative Implementations</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#slicing-for-errors" class="table-of-contents__link toc-highlight">Slicing for Errors</a><ul><li><a href="#assertion-slicing" class="table-of-contents__link toc-highlight">Assertion Slicing</a></li><li><a href="#general-slicing-for-errors" class="table-of-contents__link toc-highlight">General Slicing for Errors</a></li></ul></li><li><a href="#slicing-for-correctness" class="table-of-contents__link toc-highlight">Slicing for Correctness</a><ul><li><a href="#assumption-slicing" class="table-of-contents__link toc-highlight">Assumption Slicing</a></li><li><a href="#general-slicing-for-correctness" class="table-of-contents__link toc-highlight">General Slicing for Correctness</a></li></ul></li><li><a href="#slicing-annotations" class="table-of-contents__link toc-highlight">Slicing Annotations</a><ul><li><a href="#slicing-message-annotations" class="table-of-contents__link toc-highlight">Slicing Message Annotations</a></li><li><a href="#slicing-selections" class="table-of-contents__link toc-highlight">Slicing Selections</a></li></ul></li><li><a href="#a-theory-of-slicing-for-heyvl" class="table-of-contents__link toc-highlight">A Theory of Slicing for HeyVL</a><ul><li><a href="#slice-effects" class="table-of-contents__link toc-highlight">Slice Effects</a></li></ul></li><li><a href="#implementation-details" class="table-of-contents__link toc-highlight">Implementation Details</a><ul><li><a href="#program-transformation" class="table-of-contents__link toc-highlight">Program Transformation</a></li><li><a href="#solving-for-minimal-slices" class="table-of-contents__link toc-highlight">Solving for Minimal Slices</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/heyvl">HeyVL</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/stdlib">Standard Library</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/pgcl">pGCL</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/moves-rwth/caesar/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Caesar Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/publications">Academic Publications</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">News</a></li><li class="footer__item"><a href="https://github.com/moves-rwth/caesar" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Caesar Developers. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.639b0ec0.js"></script>
<script src="/assets/js/main.74b8c474.js"></script>
</body>
</html>